<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Visual Audit: Kala Ghoda</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    
    <link href="https://fonts.googleapis.com/css2?family=Cardo:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        /* --- THEME: MUSEUM ARCHIVE --- */
        :root {
            --bg: #ffffff;
            --text-main: #111;
            --text-sub: #555;
            --border: #e0e0e0;
            --accent: #222; /* Black accent for classiness */
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
        }
        
        body { margin: 0; padding: 0; font-family: 'Lato', sans-serif; overflow: hidden; background: #eee; }
        
        #map { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1; }

        /* THE WARMTH FILTER (Canvas only) */
        .maplibregl-canvas-container canvas {
            filter: sepia(0.15) contrast(0.95); /* Very subtle warmth */
        }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ccc; }

        /* --- UI: HEADER --- */
        #header {
            position: absolute; top: 30px; left: 30px; width: 300px;
            background: var(--bg);
            z-index: 100;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            /* Minimalist sharp corners or very slight radius */
            border-radius: 2px; 
        }

        #header h1 { 
            font-family: 'Cardo', serif; 
            font-size: 24px; font-weight: 400; 
            color: var(--text-main);
            padding: 25px 25px 5px 25px; margin: 0; 
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        #header h2 { 
            font-family: 'Lato', sans-serif; font-size: 10px; color: var(--text-sub); 
            padding: 0 25px 20px 25px; margin: 0; text-transform: uppercase; letter-spacing: 2px; 
            font-weight: 700; border-bottom: 1px solid var(--border);
        }

        /* --- UI: FILTERS (Clean Labels) --- */
        #console { padding: 20px 25px 25px 25px; display: flex; flex-wrap: wrap; gap: 8px; }
        .filter-btn {
            padding: 6px 12px;
            font-size: 10px; text-transform: uppercase; font-weight: 700; letter-spacing: 1px;
            border: 1px solid var(--border); 
            background: #fff; 
            color: var(--text-sub); cursor: pointer; 
            border-radius: 2px;
            transition: all 0.2s ease;
            display: flex; align-items: center; gap: 6px;
        }
        .filter-btn:hover { border-color: #999; color: #000; }
        .filter-btn.active { background: var(--text-main); color: #fff; border-color: var(--text-main); }
        .dot-indicator { width: 6px; height: 6px; border-radius: 50%; display: inline-block; background: currentColor; }

        /* --- UI: MARKERS --- */
        .marker {
            width: 32px; height: 32px;
            border-radius: 50%;
            /* Border is crucial for "Classy" look - separates color from map */
            border: 2px solid #fff; 
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15); 
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #fff; 
            transition: transform 0.2s ease;
            z-index: 10;
        }
        .marker:hover { transform: scale(1.15); z-index: 20; box-shadow: 0 4px 12px rgba(0,0,0,0.25); }
        .marker.selected { 
            transform: scale(1.2); z-index: 30;
            box-shadow: 0 0 0 2px #fff, 0 4px 15px rgba(0,0,0,0.3); /* Double ring effect */
        }

        /* TOOLTIP (Minimal) */
        #tooltip {
            position: absolute; pointer-events: none;
            background: #111; color: #fff;
            padding: 5px 10px; font-size: 10px; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px;
            border-radius: 2px; opacity: 0;
            transform: translate(-50%, -10px);
            transition: opacity 0.2s, transform 0.2s; 
            z-index: 500; white-space: nowrap;
        }
        
        /* --- UI: SIDE PANEL --- */
        #side-panel {
            position: fixed; right: -450px; top: 0; bottom: 0; width: 400px;
            background: #fff;
            z-index: 200;
            box-shadow: -10px 0 30px rgba(0,0,0,0.05);
            transition: right 0.6s cubic-bezier(0.19, 1, 0.22, 1); /* Elegant easing */
            overflow-y: auto; overflow-x: hidden;
            border-left: 1px solid var(--border);
        }
        #side-panel.open { right: 0; }
        
        .panel-img-container { position: relative; width: 100%; height: 320px; overflow: hidden; }
        .panel-img { width: 100%; height: 100%; object-fit: cover; filter: saturate(0.9); transition: transform 6s ease; }
        #side-panel.open .panel-img { transform: scale(1.05); } /* Slow zoom on open */
        
        .panel-content { padding: 40px; }
        
        .panel-cat {
            font-size: 10px; text-transform: uppercase; letter-spacing: 2px; font-weight: 700;
            color: #888; margin-bottom: 15px; display: inline-block;
            border-bottom: 1px solid #eee; padding-bottom: 5px;
        }
        .panel-title {
            font-family: 'Cardo', serif; 
            font-size: 34px; font-weight: 400; 
            margin-bottom: 25px; color: var(--text-main); line-height: 1.1;
        }
        .panel-desc { 
            font-size: 16px; color: #444; line-height: 1.7; margin-bottom: 40px; 
            font-family: 'Cardo', serif; 
        }
        
        /* Clean Info Table */
        .panel-info { display: table; width: 100%; border-top: 1px solid var(--border); padding-top: 20px; }
        .panel-info-row { display: table-row; }
        .panel-info-label { display: table-cell; padding: 6px 0; font-size: 10px; text-transform: uppercase; color: #888; letter-spacing: 1px; width: 30%; }
        .panel-info-val { display: table-cell; padding: 6px 0; font-size: 13px; color: #111; font-weight: 400; }

        .panel-close {
            position: absolute; top: 20px; right: 20px; width: 32px; height: 32px;
            background: rgba(255,255,255,0.8); color: #000; border: none;
            cursor: pointer; font-size: 20px; z-index: 10;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; backdrop-filter: blur(4px);
        }
        .panel-close:hover { background: #000; color: #fff; }

        /* RESET BUTTON */
        #reset-btn {
            position: fixed; top: 30px; right: 80px; 
            background: #fff; color: #111; border: 1px solid var(--border);
            padding: 10px 16px; 
            font-family: 'Lato', sans-serif; font-weight: 700; font-size: 10px; letter-spacing: 1px;
            cursor: pointer; box-shadow: var(--shadow);
            z-index: 90; transition: all 0.2s ease;
            display: flex; align-items: center; gap: 8px;
            text-transform: uppercase; border-radius: 2px;
        }
        #reset-btn:hover { background: #111; color: #fff; border-color: #111; }

        /* MOBILE OPTIMIZATION */
        @media (max-width: 768px) {
            #header { top: 15px; left: 15px; right: 15px; width: auto; }
            #header h1 { font-size: 20px; padding: 20px 20px 5px 20px; }
            #console { padding: 15px 20px 20px 20px; }
            #side-panel { right: auto; left: 0; bottom: -100vh; top: auto; width: 100%; height: 80vh; border-left: none; border-top: 1px solid #ccc; }
            #side-panel.open { bottom: 0; }
            #reset-btn { top: auto; bottom: 30px; right: 20px; } 
        }
    </style>
</head>

<body>

    <div id="map"></div>
    <div id="tooltip"></div> 
    
    <div id="header">
        <h1>Visual Audit: Kala Ghoda</h1>
        <h2>Heritage Survey</h2>
        <div id="console"></div>
    </div>

    <button id="reset-btn"><i class="fa-solid fa-compress"></i> Reset Map</button>

    <div id="side-panel">
        <button class="panel-close" id="close-btn">×</button>
        <div id="panel-inner"></div>
    </div>

    <script>
        window.addEventListener('load', function() {
            initMap();
        });

        function initMap() {
            var config = {
                style: 'https://api.maptiler.com/maps/019b6fe6-78c4-7dcb-b6eb-fed1b18171df/style.json?key=f0f0aibL2C05fTzSrqHq', 
                colors: {
                    'Art Deco': '#2a9d8f',
                    'Victorian': '#e76f51',
                    'Texture': '#d4a373', 
                    'Modern': '#264653',
                    'Lettering': '#7b2cbf' 
                },
                icons: {
                    'Art Deco': 'fa-building',
                    'Victorian': 'fa-landmark',
                    'Texture': 'fa-eye',
                    'Modern': 'fa-square',
                    'Lettering': 'fa-font'
                },
                chapters: [
                    {
                        id: 'regal',
                        category: 'Art Deco',
                        title: 'Regal Cinema',
                        image: './images/regal.jpg',
                        description: 'One of the earliest Art Deco cinemas in India, characterised by ziggurat style stepping and strong vertical emphasis.',
                        year: '1933',
                        architect: 'Charles Stevens',
                        builder: 'Framji Sidhwa',
                        location: { center: [72.8334, 18.9279] }
                    },
                    {
                        id: 'museum',
                        category: 'Victorian',
                        title: 'CSMVS Museum',
                        image: './images/csmvs.jpg',
                        description: 'Indo Saracenic landmark constructed using grey Kurla basalt and yellow Malad stone.',
                        year: '1914',
                        architect: 'George Wittet',
                        builder: 'Govt. of Bombay',
                        location: { center: [72.8327, 18.9269] }
                    },
                    {
                        id: 'elphinstone',
                        category: 'Victorian',
                        title: 'Elphinstone College',
                        image: './images/elphinstone.jpg',
                        description: 'Victorian Gothic Revival building with pointed arches, stone detailing, and ornamental gargoyles.',
                        year: '1871',
                        architect: 'James Trubshawe',
                        builder: 'Unknown',
                        location: { center: [72.8313, 18.9265] }
                    },
                    {
                        id: 'sassoon',
                        category: 'Victorian',
                        title: 'David Sassoon Library',
                        image: './images/sassoon.jpg',
                        description: 'Victorian Gothic architecture defined by pointed arches, lancet windows, and symmetrical massing.',
                        year: '1870',
                        architect: 'Campbell & Gosling',
                        builder: 'Scott McClelland',
                        location: { center: [72.8316, 18.9272] }
                    },
                    {
                        id: 'army',
                        category: 'Victorian',
                        title: 'Army and Navy Building',
                        image: './images/army-navy.jpg',
                        description: 'Late nineteenth century Neo Classical commercial building retaining original serif signage.',
                        year: 'Late 19th C.',
                        architect: 'Unknown',
                        builder: 'British Military',
                        location: { center: [72.8322, 18.9285] }
                    },
                    {
                        id: 'esplanade',
                        category: 'Texture',
                        title: 'Esplanade Mansion',
                        image: './images/esplanade.jpg',
                        description: 'One of the earliest cast iron framed buildings in Mumbai, with exposed iron elements.',
                        year: '1865',
                        architect: 'Unknown',
                        builder: 'British Engineers',
                        location: { center: [72.8311, 18.9282] }
                    },
                    {
                        id: 'jehangir',
                        category: 'Modern',
                        title: 'Jehangir Art Gallery',
                        image: './images/jehangir.jpg',
                        description: 'Modernist concrete structure with a distinctive cantilevered entrance.',
                        year: '1952',
                        architect: 'G. M. Bhuta',
                        builder: 'Sir Cowasji Jehangir',
                        location: { center: [72.8317, 18.9275] }
                    },
                    {
                        id: 'statue',
                        category: 'Texture',
                        title: 'Kala Ghoda Statue',
                        image: './images/placeholder.jpg',
                        description: 'Bronze statue installed to mark the historic site of the original Black Horse.',
                        year: '2017',
                        architect: 'Commissioned Art',
                        builder: 'KG Association',
                        location: { center: [72.8318, 18.9277] }
                    },
                    {
                        id: 'synagogue',
                        category: 'Victorian',
                        title: 'Keneseth Eliyahoo',
                        image: './images/synagogue.jpg',
                        description: 'Victorian era synagogue built for the Baghdadi Jewish community, noted for its blue façade.',
                        year: '1884',
                        architect: 'Unknown',
                        builder: 'Jewish Community',
                        location: { center: [72.8324, 18.9278] }
                    },
                    {
                        id: 'ropewalk',
                        category: 'Texture',
                        title: 'Rope Walk Lane',
                        image: './images/ropewalk.jpg',
                        description: 'Historic lane characterised by enamel street signage and layered brickwork.',
                        year: '19th Century',
                        architect: 'Incremental',
                        builder: 'Multiple',
                        location: { center: [72.8320, 18.9270] }
                    },
                    {
                        id: 'army-lettering',
                        category: 'Lettering',
                        title: 'Army/Navy Signage',
                        image: './images/army-lettering.jpg',
                        description: 'Original carved and painted serif lettering integrated into the building façade.',
                        year: 'Late 19th C.',
                        architect: 'Unknown',
                        builder: 'British Military',
                        location: { center: [72.83225, 18.92855] }
                    },
                    {
                        id: 'ropewalk-signs',
                        category: 'Lettering',
                        title: 'Street Signs',
                        image: './images/ropewalk-lettering.jpg',
                        description: 'Blue enamel street signage with bilingual lettering.',
                        year: '20th Century',
                        architect: 'Municipal',
                        builder: 'BMC',
                        location: { center: [72.83205, 18.92705] }
                    }
                ]
            };

            // Setup Console
            var consoleDiv = document.getElementById('console');
            var categories = [...new Set(config.chapters.map(function(item) { return item.category; }))];
            
            var allBtn = document.createElement('button');
            allBtn.className = 'filter-btn active';
            allBtn.innerHTML = 'All Layers';
            allBtn.onclick = function() { filterMarkers('all', this); };
            consoleDiv.appendChild(allBtn);

            categories.forEach(function(cat) {
                var btn = document.createElement('button');
                btn.className = 'filter-btn';
                var color = config.colors[cat] || '#333';
                btn.innerHTML = '<span class="dot-indicator" style="color:' + color + '"></span> ' + cat;
                btn.onclick = function() { filterMarkers(cat, this); };
                consoleDiv.appendChild(btn);
            });

            // Init Map (Comfort Mode)
            var map = new maplibregl.Map({
                container: 'map',
                style: config.style,
                center: [72.8325, 18.9275],
                zoom: 16.5,
                pitch: 30, 
                bearing: -15,
                antialias: true 
            });
            map.addControl(new maplibregl.NavigationControl({ showCompass: true, showZoom: true }));
            window.mapInstance = map;

            var markerObjects = [];
            var selectedMarker = null;
            var tooltip = document.getElementById('tooltip');

            map.on("load", function () {
                // Add 3D buildings (Clean Plaster Look)
                map.addLayer({
                    'id': '3d-buildings',
                    'source': 'openmaptiles', 
                    'source-layer': 'building',
                    'type': 'fill-extrusion',
                    'minzoom': 15,
                    'paint': {
                        'fill-extrusion-color': '#e0e0e0', // Subtle light grey
                        'fill-extrusion-height': ['get', 'render_height'],
                        'fill-extrusion-base': ['get', 'render_min_height'],
                        'fill-extrusion-opacity': 0.7
                    }
                });

                config.chapters.forEach(function(record) {
                    var color = config.colors[record.category] || '#333';
                    var iconClass = config.icons[record.category] || 'fa-map-marker-alt';

                    var el = document.createElement('div');
                    el.className = 'marker';
                    el.style.backgroundColor = color; 
                    el.innerHTML = '<i class="fa-solid ' + iconClass + '"></i>';

                    el.onclick = function(e) {
                        e.stopPropagation();
                        openPanel(record, color, el);
                    };

                    el.addEventListener('mouseenter', function(e) {
                        tooltip.innerText = record.title;
                        var rect = el.getBoundingClientRect();
                        tooltip.style.left = rect.left + (rect.width / 2) + 'px';
                        tooltip.style.top = rect.top + 'px';
                        tooltip.style.opacity = '1';
                    });

                    el.addEventListener('mouseleave', function() {
                        tooltip.style.opacity = '0';
                    });

                    var marker = new maplibregl.Marker({ element: el, anchor: 'bottom' })
                        .setLngLat(record.location.center)
                        .addTo(map);

                    markerObjects.push({ element: el, category: record.category, marker: marker });
                });
            });

            document.getElementById('close-btn').addEventListener('click', function() { closePanel(false); });
            document.getElementById('reset-btn').addEventListener('click', function() {
                map.flyTo({ center: [72.8325, 18.9275], zoom: 16.5, pitch: 30, bearing: -15, duration: 2000 });
                closePanel(true);
            });
            document.addEventListener('keydown', function(event) { if (event.key === "Escape") closePanel(false); });
            map.on('click', function() { closePanel(false); });

            function openPanel(record, color, markerEl) {
                if (selectedMarker) selectedMarker.classList.remove('selected');
                markerEl.classList.add('selected');
                selectedMarker = markerEl;

                var infoHTML = '<div class="panel-info">' +
                    '<div class="panel-info-row"><span class="panel-info-label">Year</span><span class="panel-info-val">' + record.year + '</span></div>' +
                    '<div class="panel-info-row"><span class="panel-info-label">Architect</span><span class="panel-info-val">' + record.architect + '</span></div>' +
                    '<div class="panel-info-row"><span class="panel-info-label">Builder</span><span class="panel-info-val">' + record.builder + '</span></div>' +
                    '</div>';

                var panelContent = '<div class="panel-img-container"><img src="' + record.image + '" class="panel-img"></div>' +
                    '<div class="panel-content">' +
                    '<span class="panel-cat" style="color:' + color + '">' + record.category + '</span>' +
                    '<div class="panel-title">' + record.title + '</div>' +
                    '<p class="panel-desc">' + record.description + '</p>' +
                    infoHTML +
                    '</div>';

                document.getElementById('panel-inner').innerHTML = panelContent;
                document.getElementById('side-panel').classList.add('open');

                // Comfort Fly
                map.flyTo({
                    center: record.location.center,
                    zoom: 17.5,
                    pitch: map.getPitch(),
                    bearing: map.getBearing(),
                    speed: 0.8,
                    curve: 1
                });
            }

            function closePanel(preventCameraMove) {
                document.getElementById('side-panel').classList.remove('open');
                if (selectedMarker) {
                    selectedMarker.classList.remove('selected');
                    selectedMarker = null;
                }
                if (!preventCameraMove) {
                    map.flyTo({ zoom: map.getZoom() - 0.5, speed: 0.6 });
                }
            }

            function filterMarkers(selectedCat, clickedBtn) {
                var buttons = document.getElementsByClassName('filter-btn');
                for (var i = 0; i < buttons.length; i++) buttons[i].classList.remove('active');
                clickedBtn.classList.add('active');

                markerObjects.forEach(function(m) {
                    if (selectedCat === 'all' || m.category === selectedCat) {
                        m.element.style.display = 'flex';
                        m.element.style.opacity = '1';
                    } else {
                        m.element.style.display = 'none';
                    }
                });
                if (selectedMarker && selectedMarker.style.display === 'none') closePanel(false);
            }
        }
    </script>
</body>
</html>