<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Visual Audit: Kala Ghoda</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Cardo:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

   <style>
    /* --- CSS STYLING --- */
    body { margin: 0; padding: 0; font-family: 'Lato', sans-serif; }
    #map { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1; }

    /* HEADER */
    #header {
        position: absolute; top: 30px; left: 30px; width: 300px;
        background: #ffffff; z-index: 100;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        border-top: 5px solid #333;
    }
    #header h1 { font-family: 'Cardo', serif; font-size: 24px; font-weight: 700; text-transform: uppercase; padding: 25px 25px 5px 25px; margin: 0; color: #111; }
    #header h2 { font-family: 'Lato', sans-serif; font-size: 13px; color: #777; padding: 0 25px 15px 25px; margin: 0; text-transform: uppercase; letter-spacing: 1px; }

    /* FILTERS */
    #console { padding: 0 25px 25px 25px; }
    .filter-btn {
        display: inline-block; padding: 6px 12px; margin: 5px 5px 0 0;
        font-size: 11px; text-transform: uppercase; font-weight: bold;
        border: 1px solid #ccc; background: #fff; color: #555;
        cursor: pointer; border-radius: 20px; transition: all 0.2s ease;
    }
    .filter-btn:hover { background: #eee; }
    .filter-btn.active { background: #333; color: #fff; border-color: #333 !important; }

    /* CUSTOM DOTS */
    .marker {
        border-radius: 50%;
        border: 2px solid #fff;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        transition: transform 0.2s ease, opacity 0.2s ease;
    }
    .marker:hover { transform: scale(1.3); z-index: 999; }

    /* POPUPS */
    .maplibregl-popup { z-index: 200; max-width: 300px !important; }
    .maplibregl-popup-content { padding: 0; box-shadow: 0 10px 25px rgba(0,0,0,0.2); border-radius: 0; font-family: 'Lato', sans-serif; }
    .popup-img { width: 100%; height: 160px; object-fit: cover; display: block; }
    .popup-inner { padding: 20px; }
    .popup-title { font-family: 'Cardo', serif; font-size: 18px; font-weight: bold; margin-bottom: 5px; color: #111; text-transform: uppercase; }
    .popup-cat { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; display: inline-block; padding: 3px 6px; border-radius: 4px; color: #fff; margin-bottom: 10px; }
    .popup-desc { font-size: 14px; color: #555; line-height: 1.5; margin: 0; }

    /* MOBILE OPTIMIZATION */
    @media (max-width: 768px) {
        #header {
            top: 15px;
            left: 15px;
            right: 15px;
            width: auto;
            max-width: calc(100vw - 30px);
        }
        
        #header h1 {
            font-size: 20px;
            padding: 20px 20px 5px 20px;
        }
        
        #header h2 {
            font-size: 11px;
            padding: 0 20px 12px 20px;
        }
        
        #console {
            padding: 0 20px 20px 20px;
        }
        
        .filter-btn {
            padding: 8px 14px;
            margin: 5px 3px 0 0;
            font-size: 10px;
            touch-action: manipulation;
        }
        
        .maplibregl-popup {
            max-width: calc(100vw - 40px) !important;
        }
        
        .popup-img {
            height: 140px;
        }
        
        .popup-inner {
            padding: 15px;
        }
        
        .popup-title {
            font-size: 16px;
        }
        
        .popup-desc {
            font-size: 13px;
        }
        
        .marker {
            width: 16px !important;
            height: 16px !important;
        }
    }

    @media (max-width: 480px) {
        #header {
            top: 10px;
            left: 10px;
            right: 10px;
            max-width: calc(100vw - 20px);
        }
        
        #header h1 {
            font-size: 18px;
            padding: 15px 15px 5px 15px;
        }
        
        #header h2 {
            font-size: 10px;
            padding: 0 15px 10px 15px;
        }
        
        #console {
            padding: 0 15px 15px 15px;
        }
        
        .filter-btn {
            padding: 7px 11px;
            margin: 4px 2px 0 0;
            font-size: 9px;
        }
        
        .popup-img {
            height: 120px;
        }
        
        .popup-inner {
            padding: 12px;
        }
        
        .popup-title {
            font-size: 15px;
        }
        
        .popup-desc {
            font-size: 12px;
        }
        
        .marker {
            width: 14px !important;
            height: 14px !important;
        }
    }
</style>
</head>

<body>

    <div id="map"></div>
    <div id="header">
        <div id="console"></div>
    </div>

    <script>
        // --- 1. YOUR DATA CONFIGURATION (EDIT HERE) ---
        var config = {
            // Your Grey Map
            style: 'https://api.maptiler.com/maps/dataviz-v4/style.json?key=f0f0aibL2C05fTzSrqHq', 
            title: 'Visual Audit: Kala Ghoda',
            subtitle: 'A design study of Mumbai\'s Art District',
            
            // COLOR PALETTE
            colors: {
                'Art Deco': '#2a9d8f',
                'Victorian': '#e76f51',
                'Texture': '#e9c46a',
                'Modern': '#264653'
            },

            // LOCATIONS
            chapters: [
                {
                    id: 'regal',
                    category: 'Art Deco',
                    title: '1. Regal Cinema',
                    image: './images/regal.jpg',
                    description: 'India\'s first Art Deco theater. Note the Ziggurat stepping.',
                    location: { center: [72.8334, 18.9279], zoom: 17 }
                },
                {
                    id: 'museum',
                    category: 'Victorian',
                    title: '2. CSMVS Museum',
                    image: './images/csmvs.jpg',
                    description: 'Indo-Saracenic style using grey Kurla basalt and yellow Malad stone.',
                    location: { center: [72.8327, 18.9269], zoom: 17 }
                },
                {
                    id: 'elphinstone',
                    category: 'Victorian',
                    title: '3. Elphinstone College',
                    image: './images/elphinstone.jpg',
                    description: 'Romanesque Transitional style with stone gargoyles.',
                    location: { center: [72.8313, 18.9265], zoom: 17 }
                },
                {
                    id: 'sassoon',
                    category: 'Victorian',
                    title: '4. David Sassoon Library',
                    image: './images/sassoon.jpg',
                    description: 'Victorian Gothic defined by pointed arches.',
                    location: { center: [72.8316, 18.9272], zoom: 17 }
                },
                {
                    id: 'army',
                    category: 'Victorian',
                    title: '5. Army & Navy',
                    image: './images/army-navy.jpg',
                    description: 'Edwardian Neo-Classical with original serif typography.',
                    location: { center: [72.8322, 18.9285], zoom: 17 }
                },
                {
                    id: 'esplanade',
                    category: 'Texture',
                    title: '6. Esplanade Mansion',
                    image: './images/esplanade.jpg',
                    description: 'Oldest cast-iron building. Rust and exposed iron.',
                    location: { center: [72.8311, 18.9282], zoom: 17 }
                },
                {
                    id: 'jehangir',
                    category: 'Modern',
                    title: '7. Jehangir Art Gallery',
                    image: './images/jehangir.jpg',
                    description: 'Concrete Modernism with a wavy cantilevered entrance.',
                    location: { center: [72.8317, 18.9275], zoom: 17 }
                },
                {
                    id: 'statue',
                    category: 'Texture',
                    title: '8. Spirit of Kala Ghoda',
                    image: './images/placeholder.jpg',
                    description: 'Bronze statue marking the original Black Horse spot.',
                    location: { center: [72.8318, 18.9277], zoom: 17 }
                },
                {
                    id: 'synagogue',
                    category: 'Victorian',
                    title: '9. Blue Synagogue',
                    image: './images/synagogue.jpg',
                    description: 'Victorian structure with unique turquoise color.',
                    location: { center: [72.8324, 18.9278], zoom: 17 }
                },
                {
                    id: 'ropewalk',
                    category: 'Texture',
                    title: '10. Rope Walk Lane',
                    image: './images/ropewalk.jpg',
                    description: 'Vintage blue enamel signs and exposed brick.',
                    location: { center: [72.8320, 18.9270], zoom: 17 }
                }
            ]
        };

        // --- 2. SETUP HEADER ---
        var header = document.getElementById('header');
        var titleHTML = '<h1>' + config.title + '</h1><h2>' + config.subtitle + '</h2>';
        document.getElementById('console').insertAdjacentHTML('beforebegin', titleHTML);

        // --- 3. SETUP FILTERS ---
        var consoleDiv = document.getElementById('console');
        var categories = [...new Set(config.chapters.map(function(item) { return item.category; }))];
        
        // "All" Button
        var allBtn = document.createElement('button');
        allBtn.className = 'filter-btn active';
        allBtn.innerText = 'All Layers';
        allBtn.onclick = function() { filterMarkers('all', this); };
        consoleDiv.appendChild(allBtn);

        // Category Buttons
        categories.forEach(function(cat) {
            var btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.innerText = cat;
            var color = config.colors[cat] || '#333';
            btn.style.borderLeft = '4px solid ' + color;
            btn.onclick = function() { filterMarkers(cat, this); };
            consoleDiv.appendChild(btn);
        });

        // --- 4. INITIALIZE MAP ---
        var map = new maplibregl.Map({
            container: 'map',
            style: config.style,
            center: [72.8325, 18.9275],
            zoom: 16.5,
            pitch: 45,
            bearing: -15
        });
        map.addControl(new maplibregl.NavigationControl());

        // List to track markers
        var markerObjects = [];

        map.on("load", function () {
            config.chapters.forEach(function(record) {
                
                // Get Color
                var color = config.colors[record.category] || '#333';

                // Create DOT Element (CSS Class .marker)
                var el = document.createElement('div');
                el.className = 'marker';
                el.style.backgroundColor = color;
                el.style.width = '12px';
                el.style.height = '12px';

                // Create Popup
                var popupHTML = '<img src="' + record.image + '" class="popup-img">' +
                    '<div class="popup-inner">' +
                    '<span class="popup-cat" style="background:' + color + '">' + record.category + '</span>' +
                    '<div class="popup-title">' + record.title + '</div>' +
                    '<p class="popup-desc">' + record.description + '</p>' +
                    '</div>';
                    
                var popup = new maplibregl.Popup({ offset: 25, maxWidth: '300px' }).setHTML(popupHTML);

                // Add to Map
                var marker = new maplibregl.Marker(el)
                    .setLngLat(record.location.center)
                    .setPopup(popup)
                    .addTo(map);

                // Add to list for filtering
                markerObjects.push({ element: el, category: record.category });
            });
        });

        // --- 5. FILTER FUNCTION ---
        function filterMarkers(selectedCat, clickedBtn) {
            // Reset Buttons
            var buttons = document.getElementsByClassName('filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            clickedBtn.classList.add('active');

            // Show/Hide Dots
            markerObjects.forEach(function(m) {
                if (selectedCat === 'all' || m.category === selectedCat) {
                    m.element.style.display = 'block';
                    m.element.style.opacity = '1';
                } else {
                    m.element.style.display = 'none';
                }
            });
        }
    </script>

</body>
</html>